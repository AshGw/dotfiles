#!/bin/bash

# prerequisites 
source_or_dot() {
  if command -v source &> /dev/null; then
    source "$1"
  else
    . "$1"
  fi
}

# nix setup

if ! command -v xz &> /dev/null; then
  echo "install xz if ure on debian run:  sudo apt update && sudo apt -y install xz-utils"
 exit 1;
fi

sh <(curl -L https://nixos.org/nix/install) --no-daemon
source_or_dot ~/.nix-profile/etc/profile.d/nix.sh

# ncessary packages installation
nix-env -iA \
    nixpkgs.git \
    nixpkgs.curl \
    nixpkgs.wget \
    nixpkgs.zsh \
    nixpkgs.neovim \
    nixpkgs.bat 

# dircolors
curl https://raw.githubusercontent.com/seebi/dircolors-solarized/master/dircolors.ansi-dark --output ~/.dircolors


# zsh setup

sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" <<< $'\n'


rm -rf ~/.zshrc
sh -c "$(curl -fsLS chezmoi.io/get)" -- init --apply ashgw

mkdir ~/.config ~/.ssh ~/.config/nvim
touch ~/.config/nvim

# dotfiles mapping
declare -A dotfiles=(
  [".zshrc"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.zshrc"
  [".dircolors"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.dircolors"
  [".bashrc"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.bashrc"
  [".nanorc"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.nanorc"
  [".gitconfig"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.gitconfig"
  [".hushlogin"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.hushlogin"
  [".config/nvim/init.vim"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.config/nvim/init.vim"
  [".ssh/_gh_gen.sh"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.ssh/_gh_gen.sh"
  [".ssh/config"]="https://raw.githubusercontent.com/AshGw/dotfiles/main/.ssh/config"

)

for file in "${!dotfiles[@]}"; do
  curl -o "$HOME/$file" "${dotfiles[$file]}"
done

# sourcing nix 
echo '#Nix' >> ~/.zshrc
echo '. ~/.nix-profile/etc/profile.d/nix.sh' >> ~/.zshrc

# sourcing zsh
zsh
source_or_dot ~/.zshrc
